sudo: false

matrix:
  include:
  # Please remember to keep TOXENV environment variable and python attribute in sync.
  # This is a workaround to make sure that we can run tests on OSX and Windows (that have no "native" support for python)
  - {env: TOXENV=pre-commit, python: '3.6', os: linux, dist: xenial, language: python}
  - {env: TOXENV=py27, python: '2.7', os: linux, dist: xenial, language: python}
  - {env: TOXENV=py27, python: '2.7', os: osx, osx_image: xcode10, language: generic}
  - {env: TOXENV=py35, python: '3.5', os: linux, dist: xenial, language: python}
  - {env: TOXENV=py35, python: '3.5', os: osx, osx_image: xcode10, language: generic}
  - {env: TOXENV=py36, python: '3.6', os: linux, dist: xenial, language: python}
  - {env: TOXENV=py36, python: '3.6', os: osx, osx_image: xcode10, language: generic}
  - {env: TOXENV=py37, python: '3.7', os: linux, dist: xenial, language: python, sudo: required}  # NOTE: sudo: required is a workaround to https://github.com/travis-ci/travis-ci/issues/9815
  - {env: TOXENV=py37, python: '3.7', os: osx, osx_image: xcode10, language: generic}
  # TODO(maci): Add Windows tests
  - {env: TOXENV=docs, python: '3.6', os: linux, dist: xenial, language: python}

  fast_finish: true
  allow_failures:
  # Windows is available in early release, we should not block ourselves if travis has some issues with Windows for now # TODO(maci) remove this
  - os: windows

install:
- ./.travis/install.sh
- source ${HOME}/generated-environment.sh  # NOTE: The file is generated from ./.travis/install.sh

script:
- tox

after_success:
# Upload coverage data only for Python 3.6 tests on Linux
- if [ "${TRAVIS_OS_NAME}" == "linux" -a "${TOXENV}" = "py36" ]; then codecov; fi


cache:
  directories:
  - ${HOME}/.cache/pip
  - ${HOME}/.cache/pip-faster
  - ${HOME}/.cache/pre-commit
  - ${HOME}/.pyenv/
  # TODO(maci): Add cache support for chocolatey on windows. NOTE: windows is in early release and have no cache support yet

deploy:
- provider: pypi
  distributions: sdist bdist_wheel
  on:
    branch: master
    condition: $TRAVIS_OS_NAME = linux
    repo: Yelp/swagger-spec-compatibility
    tags: true
  skip_existing: true
  user: yelplabs
  password:
    secure: "vYQWDu/0rfZsmGxtTjYLcKR96DIkdTLUYQ7VECm5afzA1k0bClTcqNfNNG6HKS7tAgpCzHGMVfar0vvD93pmiS+oLq5ZLJ+Ssvo1QRemDlCA5fOVfg1HJ6j/Ss4XDNg4n4QjaLPRH8PqzhRaMBdO2LXVMwqQj9sUOkWKOchZW6YoomDWcvVS28M0aEo9YOlTtdGFrEbLKr0+O5iOqwaTwm11m4KnR7e7SgSXiGrt8/lHnYOLtdudQizTaXCgFcLqwSI4bPDawn9tRi9lf2uKMLY3Qzoy9fJmQWke6eMtrHF/MsqMkn0KPf4UW3QzRTzONoSIGvgVljjrVFRjWp9HJimLci6SaF2VxmmvsZihph19nj+uRXqweDD4QS1W37SORbEyBq4H90EzjArrlOACHtMy5aZi1WTz2fd8G530cDTWQLrwNvzSutgfupvhPbMC8p4Bm6+PBClMdjogpI1dApFauTX3nAVP8q3wa5Kn9vp/BhsbI30OcGY2sdrf7lrdXVPqTxgpiYc9GI3gyL2LsmI4qn2G+MqXQd3ZDzn8IPcrciFNOkjv6pyaiVb5yQ54VCMy6CPbMCTdyonoyoPmr67BL7v/9vcIaBP8zWRYEhOLMW9EngPMURMfNwEnly7aJHHPNh/QAy3OK8X379wB/mqTnGusmT7b0dpklIy8XDI="
